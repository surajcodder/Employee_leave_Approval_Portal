sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast"],function(e,t,o){"use strict";return e.extend("project1.controller.View1",{onInit:function(){debugger;const e=this.getOwnerComponent().getRouter();e.getRoute("View1").attachPatternMatched(this._onRouteMatched,this);let t=this.getOwnerComponent().getModel("userModel");if(!t){t=new sap.ui.model.json.JSONModel;this.getOwnerComponent().setModel(t,"userModel")}try{const e=new sap.ushell.services.UserInfo;const o=e.getEmail();const n=e.getFirstName();t.setData({username:n,email:o,firstName:n,employeeName:n})}catch(e){sap.m.MessageToast.show("User info not available. Please login again.");this.getOwnerComponent().getRouter().navTo("RouteLogin")}},_onRouteMatched:function(){const e=this.byId("leaveRequestTable");const t=e.getBinding("items");if(t){t.refresh()}},onAfterRendering:function(){debugger;const e=this.byId("leaveRequestTable");const t=e.getItems();t.forEach(e=>{const t=e.getCells()[4];const o=t.getText();if(o==="Approved"){t.addStyleClass("statusGreen")}else if(o==="Pending"){t.addStyleClass("statusOrange")}else if(o==="Cancel"){t.addStyleClass("statusRed")}});var o=this.getOwnerComponent().getModel();if(o){this._loadLeaveSummary(o)}var n=this.byId("idLeaveChart");var n=this.byId("idLeaveChart");n.setVizProperties({plotArea:{colorPalette:null,dataPointStyle:{rules:[{dataContext:{Status:"Approved"},properties:{color:"#2ecc71"}},{dataContext:{Status:"Pending"},properties:{color:"#e67e22"}},{dataContext:{Status:"Rejected"},properties:{color:"#e74c3c"}}],others:{properties:{color:"#95a5a6"}}}},legend:{visible:true,title:{visible:false}},title:{visible:true}})},_loadLeaveSummary:function(){var e=this.getView().getModel();var t=e.bindList("/LeaveRequest");t.requestContexts().then(function(e){var t={};e.forEach(function(e){var o=e.getObject();var n=o.status;if(!t[n]){t[n]=0}t[n]++});var o=Object.keys(t).map(function(e){return{status:e,count:t[e]}});var n=0,s=0,a=0,r=0;o.forEach(function(e){n+=e.count;if(e.status==="Approved"){s=e.count}else if(e.status==="Pending"){a=e.count}else if(e.status==="Rejected"){r=e.count}});var i=new sap.ui.model.json.JSONModel({LeaveSummary:o,Totals:{total:n,approved:s,pending:a,rejected:r,approvedPct:n?Math.round(s/n*100):0,pendingPct:n?Math.round(a/n*100):0,rejectedPct:n?Math.round(r/n*100):0}});this.getView().setModel(i,"summaryModel")}.bind(this)).catch(function(e){sap.m.MessageToast.show("Failed to fetch leave requests.");console.error(e)})},onUpdate:function(e){debugger;var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("UpdateLeaveReq");debugger},onCreate:function(e){debugger;var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("LeaveReqObject");debugger},onViewLeave:function(e){const t=e.getSource().getParent().getParent().getBindingContext().getProperty("ID");this.getOwnerComponent().getRouter().navTo("LeaveReqDetailed",{ID:t})},onDeleteLeave:function(e){debugger;var n=e.oSource.getModel().getServiceUrl();const s=e.getSource().getParent().getParent().getBindingContext();const a=this.getView().getModel();const r=s.getPath();t.confirm("Are you sure you want to delete this leave request?",{onClose:t=>{if(t==="OK"){debugger;const t=e.getSource().getParent().getParent().getBindingContext();const s=t.getProperty("ID");const r=`LeaveRequest(ID=${s},IsActiveEntity=true)`;debugger;$.ajax({url:n+r,type:"DELETE",success:function(){o.show("Leave request deleted.");a.refresh();this._loadLeaveSummary(a)}.bind(this),error:function(){o.show("Failed to delete leave request.")}})}}})}})});
//# sourceMappingURL=View1.controller.js.map